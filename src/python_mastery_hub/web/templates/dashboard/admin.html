<!-- Location: src/python_mastery_hub/web/templates/admin/dashboard.html -->

{% extends "base.html" %} {% block title %}Admin Dashboard - Python Mastery
Hub{% endblock %} {% block content %}
<div class="admin-dashboard">
  <div class="container">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
      <h1>Admin Dashboard</h1>
      <p>Platform management and analytics overview</p>

      <div class="header-actions">
        <a href="{{ url_for('admin.settings') }}" class="btn btn-secondary">
          <i class="icon">‚öôÔ∏è</i> Settings
        </a>
        <a href="{{ url_for('admin.analytics') }}" class="btn btn-primary">
          <i class="icon">üìä</i> Analytics
        </a>
      </div>
    </div>

    <!-- Key Statistics -->
    <div class="stats-grid">
      <div class="stat-card users">
        <div class="stat-icon">üë•</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.total_users or 0 }}</div>
          <div class="stat-label">Total Users</div>
          <div class="stat-change positive">
            +{{ stats.active_users_today or 0 }} active today
          </div>
        </div>
      </div>

      <div class="stat-card exercises">
        <div class="stat-icon">üí™</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.total_exercises or 0 }}</div>
          <div class="stat-label">Total Exercises</div>
          <div class="stat-change positive">
            +{{ stats.submissions_today or 0 }} submissions today
          </div>
        </div>
      </div>

      <div class="stat-card submissions">
        <div class="stat-icon">üìù</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.total_submissions or 0 }}</div>
          <div class="stat-label">Total Submissions</div>
          <div class="stat-change positive">
            +{{ stats.submissions_week or 0 }} this week
          </div>
        </div>
      </div>

      <div class="stat-card activity">
        <div class="stat-icon">üìà</div>
        <div class="stat-content">
          <div class="stat-number">{{ stats.active_users_month or 0 }}</div>
          <div class="stat-label">Monthly Active</div>
          <div class="stat-change positive">
            {{ ((stats.active_users_month or 0) / (stats.total_users or 1) *
            100) | round(1) }}% of total
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <!-- Charts Section -->
      <div class="content-section charts-section">
        <div class="section-header">
          <h2>Activity Overview</h2>
          <div class="chart-controls">
            <select id="chartPeriod" onchange="updateCharts()">
              <option value="7">Last 7 days</option>
              <option value="30" selected>Last 30 days</option>
              <option value="90">Last 90 days</option>
            </select>
          </div>
        </div>
        <div class="section-content">
          <div class="chart-grid">
            <div class="chart-container">
              <h3>User Growth</h3>
              <canvas id="userGrowthChart" width="400" height="200"></canvas>
            </div>
            <div class="chart-container">
              <h3>Submission Activity</h3>
              <canvas id="submissionChart" width="400" height="200"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="content-section recent-activity">
        <div class="section-header">
          <h2>Recent Activity</h2>
          <a href="{{ url_for('admin.manage_users') }}" class="btn btn-outline"
            >View All</a
          >
        </div>
        <div class="section-content">
          <div class="activity-tabs">
            <button class="tab-btn active" onclick="showTab('users')">
              New Users
            </button>
            <button class="tab-btn" onclick="showTab('submissions')">
              Recent Submissions
            </button>
          </div>

          <div id="users-tab" class="tab-content active">
            {% if recent_users %}
            <div class="activity-list">
              {% for user in recent_users %}
              <div class="activity-item">
                <div class="activity-avatar">
                  {{ user.username[0].upper() }}
                </div>
                <div class="activity-details">
                  <div class="activity-title">{{ user.username }}</div>
                  <div class="activity-meta">{{ user.email }}</div>
                  <div class="activity-time">
                    {{ user.created_at.strftime('%Y-%m-%d %H:%M') }}
                  </div>
                </div>
                <div class="activity-actions">
                  <a
                    href="{{ url_for('admin.user_detail', user_id=user.id) }}"
                    class="btn btn-sm"
                    >View</a
                  >
                </div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
              <p>No recent user registrations</p>
            </div>
            {% endif %}
          </div>

          <div id="submissions-tab" class="tab-content">
            {% if recent_submissions %}
            <div class="activity-list">
              {% for submission in recent_submissions %}
              <div class="activity-item">
                <div class="activity-icon">üìù</div>
                <div class="activity-details">
                  <div class="activity-title">
                    {{ submission.exercise_title }}
                  </div>
                  <div class="activity-meta">by {{ submission.username }}</div>
                  <div class="activity-time">
                    {{ submission.submitted_at.strftime('%Y-%m-%d %H:%M') }}
                  </div>
                </div>
                <div class="activity-score">
                  <span
                    class="score {{ 'success' if submission.score >= 80 else 'warning' if submission.score >= 60 else 'danger' }}"
                  >
                    {{ submission.score }}%
                  </span>
                </div>
              </div>
              {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
              <p>No recent submissions</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Popular Content -->
    <div class="popular-content">
      <h2>Popular Exercises</h2>
      <div class="exercises-grid">
        {% if popular_exercises %} {% for exercise in popular_exercises %}
        <div class="exercise-card">
          <div class="exercise-header">
            <h3>{{ exercise.title }}</h3>
            <span class="difficulty-badge difficulty-{{ exercise.difficulty }}">
              {{ exercise.difficulty }}
            </span>
          </div>
          <div class="exercise-stats">
            <div class="stat">
              <span class="stat-value">{{ exercise.total_submissions }}</span>
              <span class="stat-label">Submissions</span>
            </div>
            <div class="stat">
              <span class="stat-value">{{ exercise.success_rate }}%</span>
              <span class="stat-label">Success Rate</span>
            </div>
            <div class="stat">
              <span class="stat-value">{{ exercise.avg_attempts }}</span>
              <span class="stat-label">Avg Attempts</span>
            </div>
          </div>
          <div class="exercise-actions">
            <a
              href="{{ url_for('admin.exercise_detail', exercise_id=exercise.id) }}"
              class="btn btn-sm"
            >
              View Details
            </a>
          </div>
        </div>
        {% endfor %} {% else %}
        <div class="empty-state">
          <p>No exercise data available</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- System Health -->
    <div class="system-health">
      <h2>System Health</h2>
      <div class="health-grid">
        <div
          class="health-item {{ 'healthy' if system_health.database_status == 'healthy' else 'warning' }}"
        >
          <div class="health-icon">üóÑÔ∏è</div>
          <div class="health-label">Database</div>
          <div class="health-status">
            {{ system_health.database_status | title }}
          </div>
        </div>

        <div class="health-item healthy">
          <div class="health-icon">‚ö°</div>
          <div class="health-label">Response Time</div>
          <div class="health-status">
            {{ system_health.average_response_time }}
          </div>
        </div>

        <div class="health-item healthy">
          <div class="health-icon">üìä</div>
          <div class="health-label">Error Rate</div>
          <div class="health-status">{{ system_health.error_rate }}</div>
        </div>

        <div class="health-item healthy">
          <div class="health-icon">üü¢</div>
          <div class="health-label">Uptime</div>
          <div class="health-status">{{ system_health.uptime }}</div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="actions-grid">
        <a href="{{ url_for('admin.manage_users') }}" class="action-card">
          <div class="action-icon">üë•</div>
          <div class="action-title">Manage Users</div>
          <div class="action-desc">View and manage user accounts</div>
        </a>

        <a href="{{ url_for('admin.manage_exercises') }}" class="action-card">
          <div class="action-icon">üí™</div>
          <div class="action-title">Manage Exercises</div>
          <div class="action-desc">Create and edit exercises</div>
        </a>

        <a href="{{ url_for('admin.analytics') }}" class="action-card">
          <div class="action-icon">üìà</div>
          <div class="action-title">View Analytics</div>
          <div class="action-desc">Detailed platform analytics</div>
        </a>

        <a href="{{ url_for('admin.export_users') }}" class="action-card">
          <div class="action-icon">üì•</div>
          <div class="action-title">Export Data</div>
          <div class="action-desc">Download user and activity reports</div>
        </a>

        <a href="{{ url_for('admin.settings') }}" class="action-card">
          <div class="action-icon">‚öôÔ∏è</div>
          <div class="action-title">Settings</div>
          <div class="action-desc">Configure platform settings</div>
        </a>

        <a href="/api/docs" target="_blank" class="action-card">
          <div class="action-icon">üìñ</div>
          <div class="action-title">API Docs</div>
          <div class="action-desc">View API documentation</div>
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  // Tab functionality
  function showTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll(".tab-content").forEach((tab) => {
      tab.classList.remove("active");
    });

    // Remove active class from all tab buttons
    document.querySelectorAll(".tab-btn").forEach((btn) => {
      btn.classList.remove("active");
    });

    // Show selected tab
    document.getElementById(tabName + "-tab").classList.add("active");
    event.target.classList.add("active");
  }

  // Chart updating (placeholder - would integrate with actual charting library)
  function updateCharts() {
    const period = document.getElementById("chartPeriod").value;
    console.log("Updating charts for period:", period);
    // Would make AJAX call to fetch new data and update charts
  }

  // Auto-refresh dashboard data every 5 minutes
  setInterval(() => {
    fetch("/admin/api/stats")
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          // Update stat cards with new data
          updateStatCards(data.stats);
        }
      })
      .catch((error) => console.error("Error refreshing stats:", error));
  }, 300000); // 5 minutes

  function updateStatCards(stats) {
    // Update individual stat values
    Object.keys(stats).forEach((key) => {
      const element = document.querySelector(`[data-stat="${key}"]`);
      if (element) {
        element.textContent = stats[key];
      }
    });
  }
</script>

<style>
  .admin-dashboard {
    background: #f8fafc;
    min-height: 100vh;
    padding: 2rem 0;
  }

  .dashboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .dashboard-header h1 {
    font-size: 2.5rem;
    margin: 0;
    color: white;
  }

  .dashboard-header p {
    font-size: 1.1rem;
    opacity: 0.9;
    margin: 0.5rem 0 0 0;
  }

  .header-actions {
    display: flex;
    gap: 1rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: transform 0.2s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
  }

  .stat-icon {
    font-size: 2.5rem;
    opacity: 0.8;
  }

  .stat-content {
    flex: 1;
  }

  .stat-number {
    font-size: 2rem;
    font-weight: 700;
    color: #1f2937;
  }

  .stat-label {
    color: #6b7280;
    font-weight: 500;
    margin: 0.25rem 0;
  }

  .stat-change {
    font-size: 0.85rem;
    font-weight: 500;
  }

  .stat-change.positive {
    color: #10b981;
  }

  .dashboard-content {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .content-section {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    overflow: hidden;
  }

  .section-header {
    background: #f9fafb;
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .section-header h2 {
    margin: 0;
    color: #1f2937;
    font-size: 1.25rem;
  }

  .section-content {
    padding: 1.5rem;
  }

  .activity-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }

  .tab-btn {
    padding: 0.5rem 1rem;
    border: none;
    background: #f3f4f6;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .tab-btn.active {
    background: #667eea;
    color: white;
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  .activity-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    transition: all 0.2s ease;
  }

  .activity-item:hover {
    background: #f9fafb;
  }

  .activity-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #667eea;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
  }

  .activity-icon {
    font-size: 1.5rem;
  }

  .activity-details {
    flex: 1;
  }

  .activity-title {
    font-weight: 600;
    color: #1f2937;
  }

  .activity-meta {
    color: #6b7280;
    font-size: 0.9rem;
  }

  .activity-time {
    color: #9ca3af;
    font-size: 0.8rem;
  }

  .empty-state {
    text-align: center;
    padding: 2rem;
    color: #6b7280;
  }

  .popular-content,
  .system-health,
  .quick-actions {
    margin-bottom: 2rem;
  }

  .popular-content h2,
  .system-health h2,
  .quick-actions h2 {
    margin-bottom: 1.5rem;
    color: #1f2937;
  }

  .exercises-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .exercise-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
  }

  .exercise-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
  }

  .exercise-header h3 {
    margin: 0;
    color: #1f2937;
    font-size: 1.1rem;
  }

  .difficulty-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .difficulty-easy {
    background: #d1fae5;
    color: #065f46;
  }
  .difficulty-medium {
    background: #fef3c7;
    color: #92400e;
  }
  .difficulty-hard {
    background: #fee2e2;
    color: #991b1b;
  }

  .exercise-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .stat {
    text-align: center;
  }

  .stat-value {
    display: block;
    font-weight: 600;
    color: #1f2937;
  }

  .stat-label {
    font-size: 0.8rem;
    color: #6b7280;
  }

  .health-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .health-item {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    border: 2px solid #e5e7eb;
  }

  .health-item.healthy {
    border-color: #10b981;
  }

  .health-item.warning {
    border-color: #f59e0b;
  }

  .health-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .health-label {
    font-weight: 600;
    color: #374151;
    margin-bottom: 0.25rem;
  }

  .health-status {
    color: #6b7280;
    font-size: 0.9rem;
  }

  .actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
  }

  .action-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 1px solid #e5e7eb;
    text-decoration: none;
    color: inherit;
    transition: all 0.2s ease;
    text-align: center;
  }

  .action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    text-decoration: none;
    color: inherit;
  }

  .action-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
  }

  .action-title {
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 0.5rem;
  }

  .action-desc {
    color: #6b7280;
    font-size: 0.9rem;
  }

  @media (max-width: 1024px) {
    .dashboard-content {
      grid-template-columns: 1fr;
    }

    .dashboard-header {
      flex-direction: column;
      text-align: center;
    }
  }

  @media (max-width: 768px) {
    .stats-grid {
      grid-template-columns: 1fr;
    }

    .activity-item {
      flex-direction: column;
      text-align: center;
    }

    .exercise-stats {
      grid-template-columns: 1fr;
    }

    .health-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .actions-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
{% endblock %}
